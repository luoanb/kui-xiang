---
description: 开发流程和 Git 工作流规范
globs: ["**/*"]
alwaysApply: true
---

# 开发流程规则

## 开发环境
- 使用 pnpm 作为包管理器，禁止使用 npm 或 yarn
- 开发前运行 `pnpm install` 安装依赖
- 前端开发使用 `pnpm dev`，后端开发使用 `pnpm dev:server`
- 使用 TypeScript 严格模式，修复所有类型错误

## Git 工作流
- 主分支为 `main`，功能开发创建 `feature/` 分支
- 提交前运行 `pnpm build` 确保构建通过
- 使用 `vue-tsc --noEmit` 进行类型检查
- 提交信息使用中文，格式：`类型: 简短描述`

## 代码审查
- 所有代码变更必须通过 PR 审查
- PR 描述清晰说明变更内容和原因
- 确保新增代码有适当的类型定义
- 检查是否有控制台日志或调试代码残留

## 测试要求
- 关键功能必须进行手动测试
- Electron 应用需测试主进程和渲染进程交互
- 跨平台功能需在 Windows、macOS、Linux 验证
- 确保构建产物可正常打包和运行

## Electron Server 构建处理
- **依赖统一管理**：`electron/server/package.json` 的 dependencies 仅作文档参考，实际依赖统一在主 `package.json` 中管理
- **构建时处理**：Vite 构建时通过 `copy-server` 插件复制 server 代码到 `dist-electron/server`，排除 `node_modules`
- **打包时处理**：electron-builder 将主 `package.json` 的 dependencies 打包到 `app.asar`，server 代码打包到 `app.asar.unpacked/`
- **运行时解析**：Server 从 `app.asar.unpacked/` 运行，依赖通过 Node.js 模块解析机制从 `app.asar` 中获取
- **版本同步**：新增或更新 server 依赖时，需同步更新主 `package.json`，保持两个文件的依赖版本一致